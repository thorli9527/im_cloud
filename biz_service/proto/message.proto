syntax = "proto3";

package protocol;

import "common.proto";

// ========================================
// ğŸ“¨ é€šç”¨æ¶ˆæ¯ç»“æ„ä½“ï¼ˆé¡¶å±‚æ¶ˆæ¯ï¼‰
// ========================================
message Message {
  string message_id = 1;            // æ¶ˆæ¯å”¯ä¸€ IDï¼ˆå¯ç”¨äºå»é‡ã€è¿½è¸ªç­‰ï¼‰
  string sender_id = 2;             // å‘é€è€…ç”¨æˆ· ID
  string receiver_id = 3;           // æ¥æ”¶è€…ç”¨æˆ· IDï¼ˆå•èŠä¸ºå¯¹æ–¹ IDï¼Œç¾¤èŠä¸ºç¾¤ IDï¼‰
  int64 timestamp = 4;              // æ¶ˆæ¯å‘é€æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

  MessageType message_type = 5;     // æ¶ˆæ¯ä¸»ç±»å‹ï¼Œç”¨äºå¿«é€Ÿè¯†åˆ«æ¸²æŸ“æ–¹å¼ï¼ˆå¦‚ TEXTã€IMAGEï¼‰
  ChatScene scene = 6;              // ä¼šè¯åœºæ™¯ï¼šå•èŠã€ç¾¤èŠç­‰

  repeated MessageContent contents = 10; // å®é™…å†…å®¹åˆ—è¡¨ï¼Œå¯åŒ…å«å¤šæ®µå†…å®¹ï¼ˆå¦‚æ–‡æœ¬+å›¾ç‰‡ï¼‰
}

// ========================================
// ğŸ’¬ ä¼šè¯åœºæ™¯ç±»å‹ï¼ˆå•èŠ/ç¾¤èŠï¼‰
// ========================================
enum ChatScene {
  CHAT_UNKNOWN = 0; // æœªçŸ¥åœºæ™¯ï¼ˆå…œåº•å€¼ï¼‰
  SINGLE = 1;       // å•äººå¯¹è¯
  GROUP = 2;        // ç¾¤ç»„ä¼šè¯
}

// ========================================
// ğŸ§± æ¶ˆæ¯å†…å®¹ç»“æ„ï¼ˆæ”¯æŒ oneof å¤šç§ç±»å‹ï¼‰
// ========================================
message MessageContent {
  oneof content {
    TextMessage text = 1;             // æ–‡æœ¬æ¶ˆæ¯
    ImageMessage image = 2;           // å›¾ç‰‡æ¶ˆæ¯
    AudioMessage audio = 3;           // éŸ³é¢‘æ¶ˆæ¯
    VideoMessage video = 4;           // è§†é¢‘æ¶ˆæ¯
    LocationMessage location = 5;     // ä½ç½®æ¶ˆæ¯
    FileMessage file = 6;             // æ–‡ä»¶æ¶ˆæ¯
    AVCallMessage av_call = 7;        // éŸ³è§†é¢‘é€šè¯æ¶ˆæ¯
    CustomMessage custom = 8;         // è‡ªå®šä¹‰ç»“æ„åŒ–æ¶ˆæ¯
    EmojiMessage emoji = 9;           // è¡¨æƒ…æ¶ˆæ¯
    RevokeMessage revoke = 10;        // æ’¤å›æ¶ˆæ¯
    ForwardMessage forward = 11;      // è½¬å‘æ¶ˆæ¯
    QuoteMessage quote = 12;          // å¼•ç”¨æ¶ˆæ¯
  }
}

// ========================================
// ğŸ“„ æ–‡æœ¬æ¶ˆæ¯ä½“
// ========================================
message TextMessage {
  string text = 1; // æ–‡æœ¬å†…å®¹
}

// ========================================
// ğŸ–¼ å›¾ç‰‡æ¶ˆæ¯ä½“
// ========================================
message ImageMessage {
  string url = 1;            // å›¾ç‰‡åŸå›¾åœ°å€
  int32 width = 2;           // å›¾ç‰‡å®½åº¦ï¼ˆåƒç´ ï¼‰
  int32 height = 3;          // å›¾ç‰‡é«˜åº¦ï¼ˆåƒç´ ï¼‰
  string thumbnail_url = 4;  // ç¼©ç•¥å›¾åœ°å€ï¼ˆå¯é€‰ï¼‰
}

// ========================================
// ğŸ”Š éŸ³é¢‘æ¶ˆæ¯ä½“ï¼ˆè¯­éŸ³ï¼‰
// ========================================
message AudioMessage {
  string url = 1;        // éŸ³é¢‘æ–‡ä»¶åœ°å€
  int32 duration = 2;    // éŸ³é¢‘æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼‰
}

// ========================================
// ğŸ¥ è§†é¢‘æ¶ˆæ¯ä½“
// ========================================
message VideoMessage {
  string url = 1;            // è§†é¢‘æ’­æ”¾åœ°å€
  int32 duration = 2;        // è§†é¢‘æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼‰
  int32 width = 3;           // è§†é¢‘ç”»é¢å®½åº¦
  int32 height = 4;          // è§†é¢‘ç”»é¢é«˜åº¦
  string thumbnail_url = 5;  // è§†é¢‘å°é¢å›¾åœ°å€
}

// ========================================
// ğŸ“ ä½ç½®æ¶ˆæ¯ä½“
// ========================================
message LocationMessage {
  double latitude = 1;   // çº¬åº¦
  double longitude = 2;  // ç»åº¦
  string address = 3;    // è¯¦ç»†åœ°å€ä¿¡æ¯
  string name = 4;       // åœ°ç‚¹åç§°
}

// ========================================
// ğŸ“ æ–‡ä»¶æ¶ˆæ¯ä½“
// ========================================
message FileMessage {
  string file_name = 1;   // æ–‡ä»¶å
  string url = 2;         // æ–‡ä»¶ä¸‹è½½åœ°å€
  int64 file_size = 3;    // æ–‡ä»¶å¤§å°ï¼ˆå•ä½ï¼šå­—èŠ‚ï¼‰
  string file_type = 4;   // æ–‡ä»¶ MIME ç±»å‹ï¼ˆå¦‚ application/pdfï¼‰
}

// ========================================
// ğŸ“ éŸ³è§†é¢‘é€šè¯æ¶ˆæ¯ä½“
// ========================================
enum CallStatus {
  CALLING = 0;  // å‘¼å«ä¸­
  ACCEPTED = 1; // å·²æ¥å¬
  REJECTED = 2; // å·²æ‹’ç»
  MISSED = 3;   // æœªæ¥å¬
  ENDED = 4;    // å·²ç»“æŸ
}

message AVCallMessage {
  string call_id = 1;     // é€šè¯å”¯ä¸€æ ‡è¯† ID
  bool is_video = 2;      // æ˜¯å¦ä¸ºè§†é¢‘é€šè¯
  CallStatus status = 3;  // é€šè¯çŠ¶æ€ï¼ˆè§ä¸Šæ–¹æšä¸¾ï¼‰
  int32 duration = 4;     // å®é™…é€šè¯æ—¶é•¿ï¼ˆå•ä½ï¼šç§’ï¼‰
}

// ========================================
// ğŸ˜„ è¡¨æƒ…ç±»å‹å®šä¹‰
// ========================================
enum EmojiType {
  EMOJI_UNKNOWN = 0;  // æœªçŸ¥ç±»å‹ï¼ˆé»˜è®¤ï¼‰
  SMILE = 1; GRIN = 2; TEARS = 3; STUCK_OUT_TONGUE = 4; SCOWL = 5;
  SHY = 6; SILENT = 7; HORROR = 8; WRONGED = 9; CRAZY = 10;
  BEAUTIFUL = 11; SNOOZE = 12; SLEEP = 13; PIG = 14; GOOD = 15;
  THANKS = 16; STRONG = 17; WEAK = 18; HANDSHAKE = 19; VICTORY = 20;
  HEART = 21; BROKEN_HEART = 22; THUMBS_UP = 23; THUMBS_DOWN = 24;
  CLAP = 25; QUESTION = 26; EXCLAMATION = 27; POOP = 28;
  MOON = 29; SUN = 30; CAKE = 31; GIFT = 32; COFFEE = 33;
  ROSE = 34; WILTED_ROSE = 35; KISS = 36; HUG = 37; BOMB = 38;
  KNIFE = 39; WATERMELON = 40; BEER = 41; CAR = 42;
  MONEY = 43; LIGHTNING = 44; FIRE = 45; PRESENT = 46;
  MUSIC = 47; PHONE = 48;
  CUSTOM_EMOJI = 1000; // è‡ªå®šä¹‰è¡¨æƒ…ï¼ˆé€šè¿‡å›¾ç‰‡ URL æŒ‡å®šï¼‰
}

message EmojiMessage {
  EmojiType emoji = 1;             // è¡¨æƒ…ç±»å‹
  string custom_emoji_url = 2;     // è‹¥ä¸ºè‡ªå®šä¹‰è¡¨æƒ…ï¼Œéœ€æä¾› URL åœ°å€
}

// ========================================
// ğŸ”™ æ’¤å›æ¶ˆæ¯ä½“
// ========================================
message RevokeMessage {
  string target_message_id = 1;    // è¢«æ’¤å›çš„æ¶ˆæ¯ ID
  string operator_id = 2;          // å‘èµ·æ’¤å›æ“ä½œçš„ç”¨æˆ· ID
  int64 revoke_time = 3;           // æ’¤å›å‘ç”Ÿæ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰
}

// ========================================
// ğŸ“¤ è½¬å‘æ¶ˆæ¯ä½“
// ========================================
message ForwardMessage {
  string original_message_id = 1;  // åŸå§‹æ¶ˆæ¯ ID
  string original_sender_id = 2;   // åŸå‘é€è€… ID
  MessageType original_type = 3;   // åŸæ¶ˆæ¯ä¸»ç±»å‹
  string summary = 4;              // åŸå†…å®¹æ‘˜è¦ï¼ˆç”¨äºé¢„è§ˆå±•ç¤ºï¼‰
}

// ========================================
// ğŸ“Œ å¼•ç”¨æ¶ˆæ¯ä½“ï¼ˆå›å¤æŸæ¡å†å²æ¶ˆæ¯ï¼‰
// ========================================
message QuoteMessage {
  string quoted_message_id = 1;       // è¢«å¼•ç”¨çš„å†å²æ¶ˆæ¯ ID
  string quoted_content_preview = 2;  // å¼•ç”¨çš„å†…å®¹é¢„è§ˆæ‘˜è¦ï¼ˆçº¯æ–‡æœ¬ï¼‰
  string quote_text = 3;              // å›å¤çš„æ­£æ–‡å†…å®¹
}

// ========================================
// ğŸ§© è‡ªå®šä¹‰ç»“æ„åŒ–æ¶ˆæ¯ä½“
// ========================================
message CustomMessage {
  string custom_type = 1;     // è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹æ ‡è¯†ï¼ˆå¦‚ "vote", "card"ï¼‰
  string json_payload = 2;    // ç»“æ„åŒ– JSON å†…å®¹ï¼Œæ ¼å¼ç”±å®¢æˆ·ç«¯çº¦å®šè§£æ
}