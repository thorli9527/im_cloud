syntax = "proto3";

package protocol.message;

import "common.proto"; // å¼•å…¥å…¬å…±ç±»å‹ï¼Œå¦‚ UserProfileã€MediaMeta å¯è‡ªå®šä¹‰

// ======================================
// ğŸ’¬ ä¼šè¯åœºæ™¯ç±»å‹
// ======================================
enum ChatScene {
  CHAT_UNKNOWN = 0; // é»˜è®¤æœªçŸ¥åœºæ™¯ï¼ˆé˜²å¾¡å€¼ï¼‰
  SINGLE = 1;       // å•äººä¼šè¯
  GROUP = 2;        // ç¾¤èŠä¼šè¯
}

// ======================================
// ğŸ˜„ Emoji ç±»å‹å®šä¹‰ï¼ˆæ ‡å‡† + è‡ªå®šä¹‰ï¼‰
// ======================================
enum EmojiType {
  EMOJI_UNKNOWN = 0;
  SMILE = 1;
  GRIN = 2;
  TEARS = 3;
  STUCK_OUT_TONGUE = 4;
  CLAP = 25;
  POOP = 28;
  HEART = 21;
  // ... å¯ç»§ç»­æ‰©å±•æ ‡å‡† Emoji
  CUSTOM_EMOJI = 1000; // è‡ªå®šä¹‰è¡¨æƒ…ï¼ˆé€šè¿‡å›¾ç‰‡ URL æŒ‡å®šï¼‰
}

// ======================================
// ğŸ“¨ é¡¶å±‚æ¶ˆæ¯ç»“æ„
// ======================================
message Content {
  string message_id = 1;              // å”¯ä¸€æ¶ˆæ¯ IDï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆæˆ–æœåŠ¡ç«¯è¡¥å…¨ï¼‰
  string sender_id = 2;               // æ¶ˆæ¯å‘é€æ–¹
  string receiver_id = 3;             // æ¶ˆæ¯æ¥æ”¶æ–¹ï¼ˆå•èŠä¸ºå¯¹æ–¹ IDï¼Œç¾¤èŠä¸ºç¾¤ IDï¼‰
  int64 timestamp = 4;                // æ¶ˆæ¯å‘é€æ—¶é—´ï¼ˆæ¯«ç§’æ—¶é—´æˆ³ï¼‰

  common.ContentType message_type = 5;       // ä¸»æ¶ˆæ¯ç±»å‹ï¼ˆç”¨äºå¿«é€Ÿæ¸²æŸ“åˆ¤æ–­ï¼‰
  ChatScene scene = 6;                // æ¶ˆæ¯æ‰€å±ä¼šè¯ç±»å‹ï¼ˆå•èŠ/ç¾¤èŠï¼‰

  repeated MessageContent contents = 10; // å¤šæ®µå¤åˆå†…å®¹ï¼ˆå¦‚æ–‡æœ¬ + å›¾ç‰‡ï¼‰
}

// ======================================
// ğŸ’  æ¶ˆæ¯å†…å®¹ç»“æ„ï¼ˆoneof ç±»å‹ï¼‰
// ======================================
message MessageContent {
  oneof content {
    TextContent text = 1;
    ImageContent image = 2;
    AudioContent audio = 3;
    VideoContent video = 4;
    LocationContent location = 5;
    FileContent file = 6;
    AVCallContent av_call = 7;
    CustomContent custom = 8;
    EmojiContent emoji = 9;
    RevokeContent revoke = 10;
    ForwardContent forward = 11;
    QuoteContent quote = 12;
    HtmlContent html = 13;
    VoipContent voip = 14;
    NotificationContent notification = 15;
    SystemContent system = 16;
    ReminderContent reminder = 17;
    GroupEventContent group_event = 18;
    ContactCardContent contact_card = 19;
    VoteContent vote = 20;
    RedEnvelopeContent red_envelope = 21;
  }
}



// ===============================
// ğŸ“„ æ–‡æœ¬æ¶ˆæ¯
// ===============================
message TextContent {
  string text = 1;                      // æ–‡æœ¬ä¸»ä½“å†…å®¹
  repeated InlineEntity entities = 2;  // å¯Œæ–‡æœ¬å®ä½“ï¼Œå¦‚é“¾æ¥/@ç”¨æˆ·/è¯é¢˜
}

message InlineEntity {
  int32 start = 1;                     // èµ·å§‹ä½ç½®ï¼ˆUTF-8 å­—ç¬¦ç´¢å¼•ï¼‰
  int32 end = 2;                       // ç»“æŸä½ç½®ï¼ˆä¸å«ï¼‰
  string type = 3;                     // ç±»å‹ï¼šlink / mention / hashtag
  string value = 4;                    // é™„åŠ å€¼ï¼šURLã€ç”¨æˆ·IDç­‰
}

// ===============================
// ğŸ–¼ï¸ å›¾ç‰‡æ¶ˆæ¯
// ===============================
message ImageContent {
  string url = 1;                      // åŸå›¾ URL
  string thumbnail_url = 2;           // ç¼©ç•¥å›¾ URL
  int32 width = 3;                     // å®½åº¦ï¼ˆåƒç´ ï¼‰
  int32 height = 4;                    // é«˜åº¦ï¼ˆåƒç´ ï¼‰
  string format = 5;                   // æ ¼å¼ï¼ˆå¦‚ jpg/pngï¼‰
  int64 size = 6;                      // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
}

// ===============================
// ğŸ”Š éŸ³é¢‘æ¶ˆæ¯
// ===============================
message AudioContent {
  string url = 1;
  int32 duration = 2;
  string format = 3;
  int64 size = 4;
  bool is_voice = 5;                   // æ˜¯å¦è¯­éŸ³ï¼ˆvs éŸ³ä¹ç±»éŸ³é¢‘ï¼‰
}

// ===============================
// ğŸï¸ è§†é¢‘æ¶ˆæ¯
// ===============================
message VideoContent {
  string url = 1;
  int32 duration = 2;
  string cover_url = 3;
  int32 width = 4;
  int32 height = 5;
  string format = 6;
  int64 size = 7;
}

// ===============================
// ğŸ“ ä½ç½®æ¶ˆæ¯
// ===============================
message LocationContent {
  double latitude = 1;
  double longitude = 2;
  string address = 3;
  string poi_name = 4;
  string thumbnail_url = 5;
}

// ===============================
// ğŸ“ æ–‡ä»¶æ¶ˆæ¯
// ===============================
message FileContent {
  string url = 1;
  string name = 2;
  int64 size = 3;
  string file_type = 4;
  string icon_url = 5;
}

// ===============================
// ğŸ“ éŸ³è§†é¢‘é€šè¯ä¿¡ä»¤
// ===============================
message AVCallContent {
  string call_id = 1;
  string initiator_id = 2;
  repeated string participant_ids = 3;
  enum CallAction {
    UNKNOWN = 0;
    INVITE = 1;
    ACCEPT = 2;
    REJECT = 3;
    CANCEL = 4;
    END = 5;
    TIMEOUT = 6;
  }
  CallAction action = 4;
  enum CallType {
    AUDIO = 0;
    VIDEO = 1;
  }
  CallType type = 5;
  int64 timestamp = 6;
  int32 duration = 7;
}

// ===============================
// ğŸ’  è‡ªå®šä¹‰ç»“æ„åŒ–æ¶ˆæ¯
// ===============================
message CustomContent {
  string custom_type = 1;
  string json_payload = 2;
}

// ===============================
// ğŸ˜„ è¡¨æƒ…æ¶ˆæ¯
// ===============================
message EmojiContent {
  EmojiType emoji = 1;
  string custom_emoji_url = 2;
}

// ===============================
// â›” æ’¤å›æ¶ˆæ¯
// ===============================
message RevokeContent {
  string target_message_id = 1;
  string operator_id = 2;
  int64 revoke_time = 3;
}

// ===============================
// ğŸ“¤ è½¬å‘æ¶ˆæ¯
// ===============================
message ForwardContent {
  string original_message_id = 1;
  string original_sender_id = 2;
  common.ContentType original_type = 3;
  string summary = 4;
}

// ===============================
// ğŸ“Œ å¼•ç”¨å›å¤æ¶ˆæ¯
// ===============================
message QuoteContent {
  string quoted_message_id = 1;
  string quoted_content_preview = 2;
  string quote_text = 3;
}

// ===============================
// ğŸŒ HTML å¡ç‰‡
// ===============================
message HtmlContent {
  string title = 1;
  string url = 2;
  string preview = 3;
}

// ===============================
// ğŸ“ VOIP é€šè¯è®°å½•
// ===============================
message VoipContent {
  string caller_id = 1;
  string callee_id = 2;
  int64 duration = 3;
  string status = 4;
}

// ===============================
// ğŸ”” é€šçŸ¥æ¶ˆæ¯
// ===============================
message NotificationContent {
  string title = 1;
  string body = 2;
  map<string, string> metadata = 3;
}

// ===============================
// âš™ï¸ ç³»ç»Ÿæ¶ˆæ¯
// ===============================
message SystemContent {
  string content = 1;
  string code = 2;
}

// ===============================
// â° æé†’äº‹é¡¹
// ===============================
message ReminderContent {
  string text = 1;
  int64 remind_at = 2;
}


// ===============================
// ğŸ‘ª ç¾¤ç»„äº‹ä»¶
// ===============================
message GroupEventContent {
  string group_id = 1;
  string event = 2;
  string operator_id = 3;
}

// ===============================
// ğŸ“‡ åç‰‡æ¶ˆæ¯
// ===============================
message ContactCardContent {
  string target_id = 1;
  string display_name = 2;
  string avatar_url = 3;
  string card_type = 4;
}

// ===============================
// ğŸ“Š æŠ•ç¥¨æ¶ˆæ¯
// ===============================
message VoteContent {
  string topic = 1;
  repeated string options = 2;
  map<string, int32> result = 3;
  bool multi_choice = 4;
}

// ===============================
// ğŸ’° çº¢åŒ…æ¶ˆæ¯
// ===============================
message RedEnvelopeContent {
  string sender_id = 1;
  int32 amount = 2;
  string blessing = 3;
  bool claimed = 4;
}

// ======================================
// âœ‚ï¸ Segment - æ¶ˆæ¯æ®µç»“æ„ï¼ˆç”¨äºå¤åˆå†…å®¹ï¼‰
// ======================================
// è¡¨ç¤ºä¸€æ¡æ¶ˆæ¯ä¸­çš„ä¸€ä¸ªç‹¬ç«‹æ®µï¼ˆå¦‚æ–‡æœ¬æ®µã€å›¾ç‰‡æ®µç­‰ï¼‰ï¼Œæ”¯æŒæ’åºã€ç¼–è¾‘ã€æ ‡è®°ç­‰
message Segment {
  MessageContent body = 1;                // æ¶ˆæ¯æ®µå†…å®¹ï¼ˆå¦‚æ–‡æœ¬ã€å›¾ç‰‡ç­‰ï¼Œä½¿ç”¨ oneof å°è£…ï¼‰

  string segment_id = 2;                  // æ®µå”¯ä¸€æ ‡è¯†ï¼ˆå®¢æˆ·ç«¯ç”Ÿæˆæˆ–æœåŠ¡ç«¯è¡¥å…¨ï¼‰
  uint64 seq_in_msg = 3;                  // æ¶ˆæ¯å†…é¡ºåºç¼–å·ï¼ˆç”¨äºå‰ç«¯æ¸²æŸ“æ’åºï¼‰

  bool edited = 4;                        // æ˜¯å¦ä¸ºç¼–è¾‘åçš„æ®µè½ï¼ˆtrue è¡¨ç¤ºè¢«ä¿®æ”¹ï¼‰
  bool visible = 5;                       // æ˜¯å¦å…è®¸å®¢æˆ·ç«¯æ¸²æŸ“è¯¥æ®µï¼ˆfalse å¯ç”¨äºéšè—è‰ç¨¿ç­‰ï¼‰

  map<string, string> metadata = 6;       // é€šç”¨æ‰©å±•å­—æ®µï¼ˆä»¥å­—ç¬¦ä¸²é”®å€¼å¯¹å­˜å‚¨ JSON æ‰å¹³æ•°æ®ï¼‰
}
