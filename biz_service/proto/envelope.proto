syntax = "proto3";

package protocol.envelope;

// ================================
// ğŸ“¦ å¼•ç”¨å„ç±»æ¶ˆæ¯æ¨¡å—
// ================================
import "auth.proto";     // ç™»å½•è®¤è¯è¯·æ±‚ä¸å“åº”
import "message.proto";  // èŠå¤©æ¶ˆæ¯ç»“æ„
import "status.proto";   // çŠ¶æ€ç±»æ¶ˆæ¯ï¼Œå¦‚å·²è¯»ã€æ­£åœ¨è¾“å…¥ç­‰
import "system.proto";   // ç³»ç»Ÿé€šçŸ¥ç±»æ¶ˆæ¯
import "friend.proto";   // å¥½å‹å…³ç³»å˜æ›´ç›¸å…³æ¶ˆæ¯
import "group.proto";    // ç¾¤ç»„ç›¸å…³äº‹ä»¶ã€ç»“æ„
import "user.proto";     // ç”¨æˆ·èµ„æ–™æ›´æ–°ç±»ç»“æ„

// ================================
// âœ‰ï¸ å°åŒ…ç±»å‹æšä¸¾
// ================================
// ç”¨äºæ ‡è®°å°åŒ…æ–¹å‘/è¯­ä¹‰ï¼Œä¾¿äºæœåŠ¡ç«¯è·¯ç”±ä¸å®¢æˆ·ç«¯è§£æ
enum EnvelopeType {
  CLIENT_TO_SERVER = 0; // å®¢æˆ·ç«¯ â†’ æœåŠ¡ç«¯è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚å‘æ¶ˆæ¯ã€è®¤è¯ç­‰ï¼‰
  SERVER_TO_CLIENT = 1; // æœåŠ¡ç«¯ â†’ å®¢æˆ·ç«¯æ¨é€ï¼ˆå¦‚é€šçŸ¥ã€æ–°æ¶ˆæ¯ç­‰ï¼‰
  ACK = 2;              // å®¢æˆ·ç«¯/æœåŠ¡ç«¯äº’ç›¸ç¡®è®¤æ¶ˆæ¯ï¼ˆç”¨äºå¯é é€šä¿¡/è¿½è¸ªï¼‰
}

// ================================
// âœ‰ï¸ é¡¶å±‚æ¶ˆæ¯å°åŒ…ç»“æ„ Envelope
// ================================
// æ‰€æœ‰é€šä¿¡å†…å®¹éƒ½é€šè¿‡ Envelope å°è£…å‘é€ï¼Œ
// æ”¯æŒå¤šç§æ¶ˆæ¯è½½è·ç±»å‹ï¼Œä¾¿äºç»Ÿä¸€åè®®ã€ä¼ è¾“å’Œæ‰©å±•ã€‚
message Envelope {
  string envelope_id = 1;          // å°åŒ…å”¯ä¸€ IDï¼ˆå¯ç”¨äºé“¾è·¯è¿½è¸ªã€æ—¥å¿—å®šä½ï¼‰
  EnvelopeType envelope_type = 2; // å°åŒ…ç±»å‹ï¼ˆCLIENT_TO_SERVER / SERVER_TO_CLIENT / ACKï¼‰
  int64 timestamp = 3;            // å°åŒ…åˆ›å»ºæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

  // ================================
  // ğŸ“¦ å°è£…è´Ÿè½½ä¸»ä½“ oneof
  // ================================
  // æ¯ä¸ªå°åŒ…åªåŒ…å«ä¸€ç§æ¶ˆæ¯ç±»å‹ï¼Œoneof ä¿è¯ç»“æ„å”¯ä¸€æ€§
  oneof payload {
    // ğŸ” ç™»å½•è®¤è¯
    auth.AuthRequest auth_request = 4;     // å®¢æˆ·ç«¯å‘èµ·è®¤è¯è¯·æ±‚ï¼ˆè¿æ¥å»ºç«‹åç¬¬ä¸€æ­¥ï¼‰
    auth.AuthResponse auth_response = 5;   // æœåŠ¡ç«¯è¿”å›è®¤è¯ç»“æœ

    // ğŸ’¬ èŠå¤©æ¶ˆæ¯
    message.Message message = 6;              // æ™®é€šæ¶ˆæ¯ï¼šæ–‡æœ¬ã€å›¾ç‰‡ã€å¼•ç”¨ç­‰

    // ğŸ§¾ æ¶ˆæ¯çŠ¶æ€ç±»
    status.ReadReceipt read_receipt = 7;     // æ¶ˆæ¯å·²è¯»å›æ‰§ï¼ˆå•èŠæˆ–ç¾¤èŠï¼‰
    status.TypingNotice typing_notice = 9;   // æ­£åœ¨è¾“å…¥çŠ¶æ€é€šçŸ¥
    status.AckMessage ack = 12;              // é€šç”¨ ACK ç¡®è®¤æ¶ˆæ¯
    status.Heartbeat heartbeat = 13;         // å¿ƒè·³åŒ…ï¼ˆè¿æ¥ä¿æ´»ï¼‰

    // ğŸ› ï¸ ç³»ç»Ÿé€šçŸ¥
    system.SystemNotification system_notification = 8; // ç³»ç»Ÿé€šçŸ¥æ¶ˆæ¯ï¼ˆç»´æŠ¤ã€å°ç¦ç­‰ï¼‰

    // ğŸ¤ å¥½å‹äº‹ä»¶ç±»
    friend.FriendEventMessage friend_event = 14;       // å¥½å‹è¯·æ±‚ã€åŒæ„ã€æ‹’ç»ã€æ‹‰é»‘ç­‰äº‹ä»¶

    // ğŸ‘¤ ç”¨æˆ·/ç¾¤ç»„å˜æ›´äº‹ä»¶
    user.UserFlush user_flush = 15;                  // ç”¨æˆ·èµ„æ–™æ›´æ–°é€šçŸ¥ï¼ˆæ˜µç§°ã€å¤´åƒç­‰å˜æ›´ï¼‰
    // ğŸ‘¥ ç¾¤ç»„ç»“æ„äº‹ä»¶
    gi.GroupMemberChange group_member_change = 10;     // ç¾¤æˆå‘˜å¢åˆ ã€ç¦è¨€ã€è¸¢äººç­‰
    gi.GroupAttributeChange group_attribute_change = 11; // ç¾¤å±æ€§å­—æ®µå˜æ›´ï¼ˆå•å­—æ®µï¼‰

    gi.GroupCreateMessage group_create = 17;           // åˆ›å»ºç¾¤èŠæˆåŠŸäº‹ä»¶
    gi.GroupDismissMessage group_dismiss = 18;         // ç¾¤èŠè¢«è§£æ•£é€šçŸ¥
    gi.GroupTransferMessage group_transfer = 19;       // ç¾¤ä¸»è½¬è®©äº‹ä»¶
    gi.GroupAnnouncementMessage group_announcement = 20; // ç¾¤å…¬å‘Šæ›´æ–°äº‹ä»¶
  }
}
